(()=>{"use strict";var t={823:(t,e,n)=>{n.r(e)},607:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this.eType="",this.ID=Math.random().toString(36).substr(2,9),this.stage=t,this.components=e.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.type]:[e]})),{})}initComponent(t){const e=this;this.components[t].forEach((t=>{t.onInit&&t.onInit(e)}))}componentList(){return Object.keys(this.components).map((t=>this.components[t]))}getComponent(t){var e;return(null===(e=this.components[t])||void 0===e?void 0:e[0])||null}addComponent(t){this.components[t.type]||(this.components[t.type]=[]),this.components[t.type].push(t)}render(t,e=[0,0]){this.componentList().forEach((n=>n.forEach((n=>n.onRender?n.onRender(this,t,e):null))))}onUpdateStart(t,e){}onUpdateEnd(t,e){}update(t,e){null==this||this.onUpdateStart(t,e),this.componentList().forEach((n=>{n.forEach((n=>n.onUpdate?n.onUpdate(this,t,e):null))})),null==this||this.onUpdateStart(t,e)}onCollide(t){throw new Error("Method not implemented.")}destroy(){this.componentList().forEach((t=>t.forEach((t=>(null==t?void 0:t.onTerminate)&&(null==t?void 0:t.onTerminate(this))))))}init(){this.componentList().forEach((t=>t.forEach((t=>this.initComponent(t.type)))))}}class o{constructor(t,e=[0,0]){this.type="position",this.p=t,this.direction=1}}class r{constructor(t,e=[0,0],n=[200,200],s=1){this.a=[0,0],this.maxA=[10,10],this.collisionSensors=[null,null,null,null],this.type="position",this.p=t,this.lp=t,this.v=e,this.direction=s,this.maxSpeed=n}accelerate(t){this.a=f(this.a,t)}stopDir(t){this.a[0]=t[0]?0:this.a[0],this.a[1]=t[1]?0:this.a[1]}onUpdate(t,e,n){const{solid:s,onCollide:i}=t.getComponent("collider"),o=this.maxSpeed;let{p:[r,a],v:[h,l],a:[d,c]}=this;this.lp[0]=r,this.lp[1]=a,h+=d,l+=c,h=Math.abs(h)>o[0]?o[0]*Math.sign(h):h,l=Math.abs(l)>o[1]?o[1]*Math.sign(l):l;const[u,p,g,f]=this.collisionSensors,C={d:null},[{d:v},{d:b},{d:y},{d:w}]=[null!=u?u:C,null!=p?p:C,null!=g?g:C,null!=f?f:C];let _=m(l,e),L=m(h,e);const x=(t,e)=>null!==t&&Math.abs(e)>Math.abs(t);s&&(_>0&&x(y,_)?(_=y*Math.sign(_),l=0):_<0&&x(v,_)&&(_=v*Math.sign(_),l=0),L>0&&x(b,L)?(L=b*Math.sign(L),h=0):L<0&&x(w,L)&&(L=w*Math.sign(L),h=0)),this.a=[0,0],this.v=[h,l],this.p=[r+L,a+_]}}class a{constructor(t,e){this.posModifiers=[0,0],this.collisions=[],this.solid=!0,this.type="collider",this.box=t,this.trigger=!0,this.onCollideFn=e,this.isColliding=!1}onInit(t){var e;this.onCollide=(null===(e=this.onCollideFn)||void 0===e?void 0:e.bind(t))||null,this.boxPos=t.getComponent("position").p}onUpdate(t,e,n){const[s,i]=t.getComponent("position").p;this.boxPos=[s+this.posModifiers[0],i+this.posModifiers[1]]}}class h{constructor(t,e,n=0){this.imgPos=[0,0],this.type="render",this.sprite=t,this.renderPriority=n,this.setupAnimation(e)}onInit(t){this.stage=t.stage}setupAnimation(t){this.time=0,this.currentFrame=0,this.currentAnimation=t}onRender(t,e,n){const s=t.getComponent("position").p;if(!s)throw new Error("PositionComponent not found");const[i,o]=s,r=this.sprite[this.currentAnimation];this.time+=e,r||console.error(`Animation ${this.currentAnimation} not found`),this.time>r.changeTime&&(this.time=0,this.currentFrame=(this.currentFrame+1)%r.frames.length);const a=this.stage.ctx;a.beginPath(),a.drawImage(r.frames[this.currentFrame],i+n[0]+this.imgPos[0],o+n[1]+this.imgPos[1],r.frames[this.currentFrame].width,r.frames[this.currentFrame].height),a.closePath()}}class l{constructor(t,e=99){this.type="render",this.image=t,this.renderPriority=e}onInit(t){this.stage=t.stage}onRender(t,e,n){const s=t.getComponent("position").p;this.stage.ctx.drawImage(this.image,s[0]+n[0],s[1]+n[1])}}class d{constructor(t=1,e=null){this.type="gravity",this.gravity=9.8*t,this.ev=e||100*t}onUpdate(t,e){t.getComponent("collider");const n=t.getComponent("position"),{p:[s,i],v:o}=n;n.accelerate([0,this.gravity])}}class c{constructor(t){this.behavior={},this.removers={},this.type="menu",this.selector=t,this.el=document.querySelector(t)}addListener(t,e,n="click"){this.behavior[t]={cb:e,t:n}}onInit(t){for(let t of Object.keys(this.behavior)){const e=this.el.querySelector(t),n=this.behavior[t];e&&e.addEventListener(n.t,n.cb)}this.show()}show(){this.el.classList.remove("h")}hide(){this.el.classList.add("h")}onTerminate(){this.hide()}}class u{constructor(t){this.type="html",this.selector=t}onInit(t){if(this.el=document.querySelector(this.selector),!this.el)throw new Error(`Element ${this.selector} not found`)}show(){this.el.classList.remove("h")}hide(){this.el.classList.add("h")}}class p{constructor(t={},e={}){this.type="control",this.downListener=t,this.upListener=e}onInit(t){document.addEventListener("keydown",(t=>{for(let e of Object.keys(this.downListener))e===t.key&&this.downListener[e](t)})),document.addEventListener("keyup",(t=>{for(let e of Object.keys(this.upListener))e===t.key&&this.upListener[e](t)}))}}const m=(t,e)=>Math.round(t*(e/1e3)),g=(t,e)=>t.map((t=>t*e)),f=(t,e)=>t.map(((t,n)=>t+e[n])),C=(t,e,n)=>{var s;const[i,o]=e,r=null===(s=t.getComponent("position"))||void 0===s?void 0:s.p;if(!r)return!0;const a=[r[0]+i,r[1]+o],h=200,{width:l,height:d}=n;return!(a[0]<-200||a[0]>l+h||a[1]<-200||a[1]>d+h)};class v{constructor(t){this._lastCall=t,this._limit=t}call(t,e){this._lastCall+=t,this._lastCall>this._limit&&(this._lastCall=0,e())}update(t){this._lastCall+=t}}class b{constructor(t,e){this._lived=0,this._ttl=t,this._onExpire=e}update(t){this._lived+=t,this._lived>this._ttl&&this._onExpire()}}const y=t=>Math.floor((t-400)/100),w={idle_1:[[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,0,2,2,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,3,2,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,2,2,5,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,2,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,5,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,5,5,5,3,4,4,4,4,3,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],idle_2:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,2,2,0,0,0,2,2,0,0,2,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,2,2,0,0,0,2,0,0,2,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,3,3,3,7,7,8,8,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,5,3,3,7,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,2,3,3,5,5,3,8,7,8,4,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,2,2,2,2,2,3,8,7,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,3,3,8,8,3,3,2,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,2,2,3,8,8,8,7,3,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,7,3,8,3,2,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,5,5,5,3,8,8,8,7,3,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,8,8,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],run_1:[[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,0,0,2,2,2,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,2,0,0,0,2,0,0,2,2,0,0,2,2,2,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,3,3,3,3,3,3,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,3,5,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,0,3,5,2,2,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,3,5,2,5,5,5,3,4,4,4,4,4,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,3,5,5,5,5,2,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,3,3,3,3,2,2,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,2,5,5,3,4,4,4,4,4,4,3,2,2,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0,3,5,5,5,5,5,5,5,6,6,2,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,3,3,3,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0]],fire:[[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,0,2,2,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,3,2,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,2,2,5,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,2,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,5,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,5,5,5,3,4,4,4,4,3,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,3,0,0,3,3,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,3,3,3,3,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,3,3,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],roll_1:[[0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,2,2,2,0,0,2,2,0,0,2,2,0,0,1,1,1],[0,0,0,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,1,0,1],[0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,1,1,1,1],[0,0,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,3,3,5,3,3,4,4,4,1,1,1,0,0,0,0],[0,0,0,0,0,0,3,3,3,5,5,3,4,4,4,1,1,4,3,0,0,0,0],[0,0,0,0,0,3,3,3,2,2,2,3,4,4,1,1,4,4,3,0,0,0,0],[0,0,0,0,0,3,2,2,5,5,5,3,4,1,1,4,4,3,3,2,0,0,0],[0,0,0,0,0,3,5,5,5,5,5,3,1,1,4,4,4,4,3,0,2,0,0],[0,0,0,0,0,3,5,5,2,2,2,1,1,4,4,4,3,4,3,0,0,0,0],[0,0,0,0,0,3,3,5,5,5,1,1,4,4,4,4,3,4,3,2,0,0,0],[0,0,0,0,0,3,3,3,5,1,1,3,4,4,4,4,3,4,3,0,2,0,0],[0,0,0,0,0,3,5,3,3,1,5,3,4,4,4,4,4,4,3,0,0,0,0],[0,0,0,0,0,3,5,1,3,5,5,3,3,4,4,4,4,4,3,0,0,0,0],[0,0,0,0,0,3,1,1,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0],[0,0,0,0,1,3,1,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0],[0,0,0,1,1,3,5,5,5,5,5,3,6,5,3,3,3,3,0,0,0,0,0],[0,0,1,1,0,3,3,5,5,5,5,5,5,5,3,3,3,0,0,0,0,0,0],[0,1,1,0,0,0,3,3,5,5,5,5,5,3,3,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],bolt_1:[[0,0,0,0,0,0,9,9,9,0],[0,0,0,0,0,9,10,10,10,9],[0,0,0,0,9,10,10,10,10,9],[0,0,9,9,10,10,10,11,11,9],[0,9,10,10,10,10,10,11,11,9],[0,9,10,10,10,10,10,11,11,9],[0,0,9,9,10,10,10,11,11,9],[0,0,0,0,9,10,10,10,10,9],[0,0,0,0,0,9,10,10,10,9],[0,0,0,0,0,0,9,9,9,0]],bolt_2:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,0],[0,0,0,0,9,10,10,10,10,9],[0,0,0,9,10,10,10,11,11,9],[0,0,9,10,10,10,10,11,11,9],[0,0,9,10,10,10,10,11,11,9],[0,0,0,9,10,10,10,11,11,9],[0,0,0,0,9,10,10,10,10,9],[0,0,0,0,0,9,9,9,9,0],[0,0,0,0,0,0,0,0,0,0]],colors:[null,"#642209","#e31937","#000000","#f6f4f1","#006f46","#ffe417","#ffffff","#f9f7f5","#3098c1","#187194","#aad1e7"]},_={stand_1:[[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,1,1,1,1,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,0,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,2,4,4,4,4,4,2,2,2,2,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,4,4,4,4,4,5,5,5,3,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,4,4,4,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,3,5,5,5,5,5,5,5,5,5,5,3,5,3,0,0,0,0],[0,0,0,0,3,2,3,1,1,1,1,1,1,1,1,1,1,3,2,3,0,0,0,0],[0,0,0,0,3,3,3,6,6,6,6,6,6,6,6,6,6,3,3,3,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,6,3,3,6,6,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,3,3,3,3,6,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,3,0,0,3,6,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,3,0,0,0,0,3,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,3,3,0,0,0,0,3,3,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0],[0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0],[0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0]],stand_2:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,1,1,1,1,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,0,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,2,4,4,4,4,4,2,2,2,2,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,4,4,4,4,4,5,5,5,3,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,4,4,4,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,3,5,5,5,5,5,5,5,5,5,5,3,5,3,0,0,0,0],[0,0,0,0,3,2,3,1,1,1,1,1,1,1,1,1,1,3,2,3,0,0,0,0],[0,0,0,0,3,3,3,6,6,6,6,6,6,6,6,6,6,3,3,3,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,3,3,3,3,6,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,3,0,0,3,6,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,3,0,0,0,0,3,6,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,6,3,3,0,0,0,0,3,3,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0],[0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0],[0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0]],run_1:[[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,1,1,1,1,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,0,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,2,4,4,4,4,4,2,2,2,2,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,4,4,4,4,4,5,5,5,3,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,4,4,4,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,3,5,5,5,5,5,5,5,5,5,5,3,5,3,0,0,0,0],[0,0,0,0,3,2,3,1,1,1,1,1,1,1,1,1,1,3,2,3,0,0,0,0],[0,0,0,0,3,3,3,6,6,6,6,6,6,6,6,6,6,3,3,3,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,6,3,3,6,6,6,6,3,3,0,0,0,0,0],[0,0,0,0,0,0,3,6,6,6,3,3,3,3,3,6,6,6,3,0,0,0,0,0],[0,0,0,3,3,3,3,6,6,6,3,0,0,3,3,3,6,6,3,0,0,0,0,0],[0,0,3,6,6,6,6,6,3,3,0,0,0,0,3,3,3,6,6,3,0,0,0,0],[0,0,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,3,6,6,3,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0],[0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0],[0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0]],duck:[[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,1,1,1,1,1,1,1,2,1,1,0,0,0,0,0],[0,0,0,0,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,0,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,3,2,2,2,2,2,2,2,3,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,2,4,4,4,4,4,2,2,2,2,1,0,0,0,0],[0,0,0,3,2,2,2,2,2,3,2,2,2,2,2,3,2,2,2,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,4,4,4,4,4,5,5,5,3,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,4,4,4,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,5,5,5,5,5,5,3,5,5,5,5,5,5,3,0,0,0,0],[0,0,0,0,3,5,3,5,5,5,5,5,5,5,5,5,5,3,5,3,0,0,0,0],[0,0,0,0,0,0,3,6,3,3,0,0,0,0,3,3,6,3,0,0,0,0,0,0],[0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0],[0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0],[0,0,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0]],colors:[null,"#2a2203","#f9c4b4","#000000","#0f0c00","#1d7ba7","#c22828","#4a4a4a"]};class L extends i{constructor(t,e,n,s,i={}){var o;const{stage:l}=t;super(l,[]),this.h=null,this.data={dmg:10};const d=new r(e,n,[400,600]);this.gs=t,this.c=s,this.data=Object.assign(Object.assign({},this.data),i),this.expire=new b((null===(o=this.data)||void 0===o?void 0:o.exp)||1e3,this.endTime.bind(this));const c=new h((t=>{const e=t.shaman;return{bolt:{frames:[e.bolt_1,e.bolt_2],changeTime:50},boltLeft:{frames:[e.bolt_1_left,e.bolt_2_left],changeTime:50}}})(t.images),"bolt"),u=new a([8,8],((e,n)=>{e.ID!==this.c&&("Ground"===e.eType||("Enemy"===e.eType?t.scene.removeEntity(e):"LittleDemon"===e.eType?e.takeDamage(this.data.dmg||10):"Player"===e.eType&&this.c!==e.ID&&(this.c=e.ID,null==e||e.takeDamage(this.data.dmg||10))),t.scene.removeEntity(this))}));u.solid=!1,u.posModifiers=[2,2],this.addComponent(d),this.addComponent(c),this.addComponent(u)}endTime(){this.gs.scene.removeEntity(this)}update(t,e){this.expire.update(t),super.update(t,e)}render(t,e){const n=this.getComponent("position"),s=this.getComponent("render"),i=n.v[0]>0?-1:1;-1===i&&"bolt"!==s.currentAnimation?s.setupAnimation("bolt"):1===i&&"boltLeft"!==s.currentAnimation&&s.setupAnimation("boltLeft"),super.render(t,e)}}const x=t=>{const{stand_1:e,stand_2:n,stand_1_left:s,stand_2_left:i,run_1:o,run_1_left:r,duck:a}=t.enemy;return{idle:{frames:[e,n],changeTime:500},idleLeft:{frames:[s,i],changeTime:500},run:{frames:[o,e],changeTime:150},runLeft:{frames:[r,s],changeTime:150}}},E=t=>{const e=t.demon;return{idle:{frames:[e.dem_1,e.dem_2,e.dem_3],changeTime:300}}};class k extends u{onInit(t){super.onInit(t),this.show()}onUpdate(t,e,n){const s=t.life,i=Math.floor(s/10);this.el.innerHTML="";for(let t=0;t<i;t++)this.el.innerHTML+='<div class="bar"></div>'}}class T extends u{onInit(t){super.onInit(t),this.show()}onUpdate(t,e,n){const[s,i]=n.session.pos,o=y(s);this.el.innerHTML=`${o}`}}class M{constructor(t){this.type="render",this.stage=t}onRender(t,e,n){const s=t.getComponent("position").p,i=t.fireCharge;if(!s)throw new Error("PositionComponent not found");const[o,r]=s,a=i.current/i.max,h=this.stage.ctx;h.beginPath(),h.rect(o+n[0]+4,r+n[1]+50,40*a,2),h.fillStyle="tomato",h.fill(),h.closePath()}}const S=new v(150);class I extends i{constructor(t,e,n,s,i,o=1){const{stage:l}=t;super(l,[]),this.status="idle",this.speed=200,this.maxRun=300,this.jumpSpeed=-300,this.onTheGround=!1,this.fireCharge=new at(1e3,500),this.jumpCharge=new at(200,200),this.rollCharge=new at(150,150),this.rolling=0,this.firing=!1,this.life=100,this.chargeUsage=200,this.eType="Player";const c=new r(n,[0,0],[400,400]),u=new h(e,"idle"),m={ArrowLeft:()=>{this.status="walk-left"},ArrowRight:()=>{this.status="walk-right"},ArrowUp:()=>{this.jump()},ArrowDown:()=>{this.onTheGround&&this.rollCharge.isFull&&(this.rolling=300,this.duck(),this.rollCharge.useAll())}," ":()=>{this.firing=!0}},g={ArrowLeft:()=>{this.status="idle"},ArrowRight:()=>{this.status="idle"},ArrowDown:()=>{},ArrowUp:()=>{}," ":()=>{this.firing=!1}};2===s&&(this.chargeUsage=75);const f=new p(m,g),C=new k("#life"),v=new T("#progression"),b=new a([36,48],((t,e)=>{}));b.posModifiers=[8,0];const y=new d;this.gs=t,this.onEnd=i,this.addComponent(c),this.addComponent(u),this.addComponent(f),this.addComponent(b),this.addComponent(y),this.addComponent(C),this.addComponent(v),this.addComponent(new M(l))}get invulnerable(){return this.rolling>0}update(t,e){var n;const s=this.getComponent("position");s.p[1]>800&&this.destroy(),e.session.pos=s.p,0===(null===(n=s.collisionSensors[2])||void 0===n?void 0:n.d)?(this.onTheGround=!0,this.jumpCharge.recharge(t)):this.onTheGround=!1,this.rolling>0?this.rolling-=t:(this.rollCharge.recharge(t),this._resetBox(),"walk-left"===this.status?this.walkLeft():"walk-right"===this.status?this.walkRight():"duck"===this.status?this.duck():"idle"===this.status&&this.stand()),this.firing?S.call(t,(()=>this.magicBolt())):(S.update(t),this.fireCharge.recharge(t)),super.update(t,e)}_resetBox(){this.rolling=0,this.getComponent("collider").posModifiers=[8,0],this.getComponent("render").imgPos=[0,0],this.getComponent("collider").box=[36,48]}walkLeft(){const t=this.getComponent("position"),e=this.getComponent("render");"runLeft"!==e.currentAnimation&&e.setupAnimation("runLeft");let n=-this.speed;const s=Math.abs(t.v[0]-this.speed)-this.maxRun;s>=0&&(n=-this.speed+s),this.onTheGround,t.accelerate([n,0]),t.direction=1}walkRight(){const t=this.getComponent("position"),e=this.getComponent("render");"run"!==e.currentAnimation&&e.setupAnimation("run");let n=this.speed;const s=Math.abs(t.v[0]+this.speed)-this.maxRun;s>=0&&(n=this.speed-s),this.onTheGround,t.accelerate([n,0]),t.direction=-1}jump(){const t=this.getComponent("position");this.jumpCharge.isFull&&this.onTheGround&&(t.accelerate([0,this.jumpSpeed]),this.jumpCharge.useAll())}stand(){const t=this.getComponent("position"),e=this.getComponent("render");if(1===t.direction&&"idleLeft"!==e.currentAnimation&&e.setupAnimation("idleLeft"),-1===t.direction&&"idle"!==e.currentAnimation&&e.setupAnimation("idle"),this.onTheGround)t.v=[0,t.v[1]],t.a=[0,t.a[1]];else{const e=.03*-t.v[0];t.a=[e,t.a[1]]}}duck(){const t=this.getComponent("position"),e=this.getComponent("render"),n=t.direction;-1===n&&"duck"!==e.currentAnimation?e.setupAnimation("duck"):1===n&&"duckLeft"!==e.currentAnimation&&e.setupAnimation("duckLeft"),t.v=[0,t.v[1]],t.a=[300*-t.direction,t.a[1]],this.getComponent("collider").box=[36,20],this.getComponent("collider").posModifiers=[0,28],this.getComponent("render").imgPos=[0,8]}magicBolt(){if(this.fireCharge.current<75||this.rolling)return;const t=this.getComponent("position"),e=this.getComponent("render"),n=-400*t.direction,s=t.direction;-1===s&&"fire"!==e.currentAnimation?e.setupAnimation("fire"):1===s&&"fireLeft"!==e.currentAnimation&&e.setupAnimation("fireLeft");const i=1===t.direction?t.p[0]-5:t.p[0]+32,o=new L(this.gs,[i,t.p[1]+25],[n,0],this.ID);this.gs.scene.addEntity(o),this.fireCharge.use(this.chargeUsage)}destroy(){super.destroy(),this.onEnd()}takeDamage(t){if(this.invulnerable)return;const e=this.getComponent("render");"dmg"!==e.currentAnimation&&e.setupAnimation("dmg"),this.life-=t,this.life<=0&&this.destroy()}render(t,e){super.render(t,e)}}const A=new v(100);class P extends i{constructor(t,e,n,s={}){const{stage:i}=t;super(i,[]),this.fireCharge=new at(1e3,1e3),this.firing=!1,this.data={},this.eType="Enemy";const o=new r(n),l=new h(e,"idle"),c=new a([48,48],((t,e)=>{})),u=new d;this.gs=t,this.data=s,this.addComponent(o),this.addComponent(l),this.addComponent(c),this.addComponent(u)}update(t,e){this.action(t,e),this.fireCharge.recharge(t);const n=this.getComponent("position"),s=this.getComponent("render");1===n.direction&&"idleLeft"!==s.currentAnimation&&s.setupAnimation("idleLeft"),-1===n.direction&&"idle"!==s.currentAnimation&&s.setupAnimation("idle"),super.update(t,e)}action(t,e){const n=e.scene.getEntities().find((t=>"Player"===t.eType));if(!n)return;const[s,i]=n.getComponent("position").p,[o,r]=n.getComponent("collider").box,a=this.getComponent("position"),{p:[h,l],direction:d}=a,[c,u]=this.getComponent("collider").box,[[p,m],[g,f]]=[[s+o/2,i+r/2],[h+c/2,l+u/2]],C=Math.sqrt(Math.pow(p-g,2)+Math.pow(m-f,2)),v=Math.sqrt(Math.pow(m-f,2));s<h&&1!==d?a.direction=1:s>h&&-1!==d&&(a.direction=-1),this.fireCharge.current<350&&(this.firing=!1);const b=this.firing||this.fireCharge.isFull;C<600&&v<100&&b&&(this.firing=!0,A.call(t,(()=>{this.magicBolt()})))}magicBolt(){var t;const e=(null===(t=null==this?void 0:this.data)||void 0===t?void 0:t.boltCost)||550;if(this.fireCharge.current<e)return;const n=this.getComponent("position"),s=-400*n.direction,i=1===n.direction?n.p[0]-5:n.p[0]+32,o=new L(this.gs,[i,n.p[1]+25],[s,0],this.ID);this.gs.scene.addEntity(o),this.fireCharge.use(e)}}class D extends i{constructor(t,e,n,s={}){const{stage:i}=t;super(i,[]),this.triggered=!1,this.data={},this.energy=50,this.speed=100,this.maxDist=500,this.eType="LittleDemon";const o=new r(n,[0,0],[400,400]),l=new h(e,"idle"),c=new a([30,30],((e,n)=>{"Player"!==e.eType||this.triggered||(this.triggered=!0,t.scene.removeEntity(this),null==e||e.takeDamage(50))}));c.posModifiers=[5,5];const u=new d;this.gs=t,this.speed=(null==s?void 0:s.speed)||this.speed,this.maxDist=(null==s?void 0:s.maxDist)||this.maxDist,this.data=s,this.addComponent(o),this.addComponent(l),this.addComponent(c),this.addComponent(u)}update(t,e){this.action(t,e);this.getComponent("position"),this.getComponent("render");super.update(t,e)}action(t,e){const n=e.scene.getEntities().find((t=>"Player"===t.eType));if(!n)return;const[s,i]=n.getComponent("position").p,[o,r]=n.getComponent("collider").box,a=this.getComponent("position"),{p:[h,l],direction:d}=a,[c,u]=this.getComponent("collider").box,[[p,m],[g,f]]=[[s+o/2,i+r/2],[h+c/2,l+u/2]],C=Math.sqrt(Math.pow(p-g,2)+Math.pow(m-f,2));Math.sqrt(Math.pow(m-f,2))>20||(s<h&&1!==d?a.direction=1:s>h&&-1!==d&&(a.direction=-1),C<this.maxDist&&a.accelerate([this.speed*-a.direction,0]))}takeDamage(t){const e=this.getComponent("position").v;this.getComponent("position").accelerate([-10*e[0],-200]),this.energy-=t,this.energy<=0&&this.gs.scene.removeEntity(this)}}const j=(t,e,n,s)=>{const[i,o]=t,[r,a]=e,[h,l]=n,[d,c]=s;return i<h+d&&i+r>h&&o<l+c&&o+a>l},O=document,F=window.requestAnimationFrame,U="running";class R{constructor(t){this.uFps=1e3/70,this.state="init",this.stage=t,this.lastRenderCall=0,this.lastUpdateCall=0,this.renderFps=0,this.updateFps=0,this.debugInfoCreate()}onStart(t){this.startCb=t}onPause(t){this.pauseCb=t}onResume(t){this.resumeCb=t}onUpdate(t){t&&(this.updateCb=t)}onRender(t){t&&(this.renderCb=t)}start(){this.state=U,this.startCb&&this.startCb(),this.mainLoop()}pause(){this.state="paused",this.pauseCb&&this.pauseCb()}resume(){this.state=U,this.resumeCb&&this.resumeCb()}monoLoop(){F((t=>{if(this.state===U){const t=+new Date,e=t-this.lastUpdateCall;this.updateFps=Math.floor(1e3/e),this.lastUpdateCall=t,this.updateCb&&this.updateCb(e)}const e=this.stage;e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);const n=t-this.lastRenderCall;this.renderFps=Math.floor(1e3/n),this.renderDebug(),this.lastRenderCall=t,this.renderCb&&this.renderCb(n),this.monoLoop()}))}renderLoop(){F((t=>{const e=this.stage;e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);const n=t-this.lastRenderCall;this.renderFps=Math.floor(1e3/n),this.renderDebug(),this.lastRenderCall=t,this.renderCb&&this.renderCb(n),this.renderLoop()}))}updateLoop(){setTimeout((()=>{if(this.state===U){const t=+new Date,e=t-this.lastUpdateCall;this.updateFps=Math.floor(1e3/e),this.lastUpdateCall=t,this.updateCb&&this.updateCb(e)}this.updateLoop()}),this.uFps)}mainLoop(){this.lastUpdateCall=+new Date,this.updateLoop(),this.renderLoop()}renderDebug(){const t=document.querySelector(".debug-info");let e=this.renderFps.toString()+" rFPS";e+=" /"+this.updateFps.toString()+" uFPS",e+=" ("+(+new Date).toString()+")",t.innerHTML=e}debugInfoCreate(){const t=O.createElement("div");t.className="debug-info",t.innerHTML="Game loop not started yet!",O.body.append(t)}}class q{constructor(t){this._entities=[],this.cameraPos=[0,0],this.content=t}run(t){return s(this,void 0,void 0,(function*(){return yield this.content(t,this)}))}addEntity(t){this._entities[t.ID]=t,this._entities[t.ID].init()}removeEntity(t){var e;null===(e=this._entities[t.ID])||void 0===e||e.destroy(),delete this._entities[t.ID]}getEntities(){return Object.values(this._entities)}}class G{constructor(){this.images={},this.session={},this.status="init",this._glbEntities=[],this.scene=null,this.stage=new K,this.gl=new R(this.stage)}runScene(){var t;return s(this,void 0,void 0,(function*(){return null===(t=this.scene)||void 0===t?void 0:t.run(this)}))}getImg(t){if(!this.images[t])throw new Error(`Image ${t} not found`);return this.images[t]}addEntity(t){this._glbEntities[t.ID]=t,this._glbEntities[t.ID].init()}removeEntity(t){var e;null===(e=this._glbEntities[t.ID])||void 0===e||e.destroy(),delete this._glbEntities[t.ID]}getEntities(){return Object.values(this._glbEntities)}}const $=(t,e)=>{const n=document.createElement("canvas"),[s,i]=t;n.width=s,n.height=i;e(n.getContext("2d"),[n.width/2,n.height/2]);const o=n.toDataURL("image/png"),r=document.createElement("img");return r.src=o,r};function H(t,e=2){return(n,s)=>{let[i,o]=s;i-=t[0].length*e/2,o-=t.length*e/2;for(let s=0;s<t.length;s++)for(let r=0;r<t[s].length;r++)if(null!==t[s][r]){const a=i+r*e,h=o+s*e;n.beginPath(),n.fillStyle=t[s][r],n.fillRect(a,h,e,e),n.closePath()}}}const B=(t,e)=>t[e].map((e=>e.map((e=>t.colors[e]))));function J(t){return JSON.parse(JSON.stringify(t))}const N=(t,e)=>{let n=J(e);n.colors=[...e.colors,...Object.keys(t)];JSON.stringify(n);for(let e of Object.keys(t))for(let s of t[e]){const t=n.colors.indexOf(s),i=n.colors.indexOf(e);for(let e in n)"colors"!==e&&(n[e]=n[e].map((e=>e.map((e=>e===t?i:e)))))}return n};class K{constructor(){this.canvas=O.querySelector("#stage"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=1200,this.canvas.height=800}}const Y={red:["#2a2203","#f9c4b4","#1d7ba7","#c22828"]};function Q(t){const e=t.length;for(let s=0;s<Math.round(e/2);s++)for(let i=s;i<e-s-1;i++){var n=t[s][i];t[s][i]=t[e-1-i][s],t[e-1-i][s]=t[e-1-s][e-1-i],t[e-1-s][e-1-i]=t[i][e-1-s],t[i][e-1-s]=n}}const z=(t,e=1)=>{const n=JSON.parse(JSON.stringify(t));for(let t=0;t<e;t++)Q(n);return n},V=N(Y,_),W=N(Y,w),X=[["player",2,Object.assign(Object.assign({},_),{roll_1:z(_.duck,1),roll_2:z(_.duck,2),roll_3:z(_.duck,3),dmg_1:V.stand_1,colors:V.colors})],["enemy",2,N({white:["#2a2203"],lightgrey:["#f9c4b4","#c22828"],black:["#1d7ba7"]},_)],["demon",2,{dem_1:[[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0],[0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,1,1,1,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,1,1,1,1,2,2,1,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],dem_2:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0],[0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,1,1,1,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,1,1,1,1,2,2,1,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],dem_3:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0],[0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,1,2,2,2,2,1,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,2,2,1,0,0,0],[0,0,0,1,2,2,2,2,1,2,2,2,2,2,1,1,1,0,0,0],[0,0,0,0,1,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,2,1,0,0,0,0,0],[0,0,0,0,1,2,1,1,1,1,1,2,2,1,1,0,0,0,0,0],[0,0,0,0,1,2,1,2,1,2,1,2,2,1,0,0,0,0,0,0],[0,0,0,0,1,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],colors:[null,"#000000","#f6f4f1"]}],["shaman",1.5,Object.assign(Object.assign({},w),{dmg_1:W.idle_1,roll_2:z(w.roll_1,1),roll_3:z(w.roll_1,2),roll_4:z(w.roll_1,3),colors:W.colors})]],Z={groundBlock:{d:[32,32],f:(t,e)=>{let[n,s]=e;n=Math.round(n),s=Math.round(s);t.fillStyle="#DFA878",t.beginPath(),t.rect(n-32,s-32,32,10),t.rect(n-32,s-10,32,10),t.rect(n-32,s-32,10,32),t.rect(n,s-32,10,32),t.closePath(),t.fill(),t.stroke()}}};class tt extends i{constructor(t){super(t,[new u("#loading")]),this.loadedImages={static:{}}}init(){super.init();const t=this.getComponent("html");t.el.innerHTML="Loading...",t.show(),this.loadPxImages(X),this.loadImages(Z)}loadImages(t){for(const e of Object.keys(t)){const n=$(g(t[e].d,2),t[e].f);this.loadedImages.static[e]=n}}loadPxImages(t){for(const e of t){const[t,n,s]=e;for(const e of Object.keys(s)){if("colors"===e)continue;const i=B(s,e),o=J(i).map((t=>t.reverse())),r=$([i.length*n,i[0].length*n],H(i,n)),a=$([i.length*n,i[0].length*n],H(o,n));this.loadedImages[t]||(this.loadedImages[t]={}),this.loadedImages[t][e]=r,this.loadedImages[t][e+"_left"]=a}}}destroy(){super.destroy();this.getComponent("html").hide()}}class et extends i{constructor(t,e,n){const{stage:s}=t;super(s,[]),this.eType="Ground";const i=new o(e),r=new l(t.images.static.groundBlock),h=new a([32,32]);this.addComponent(i),this.addComponent(r),this.addComponent(h),this.name=n}render(t,e){super.render(t,e);const[n,s]=this.getComponent("position").p,i=this.stage.ctx;i.beginPath(),i.font="20px serif",i.fillStyle="white",i.closePath()}}class nt extends u{onInit(t){super.onInit(t),this.show()}onUpdate(t,e,n){var s;this.el.innerHTML=`<span>${(null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.lives)||""}</span>`}}class st extends i{constructor(t){const{stage:e}=t;super(e,[]);const n=new nt("#lives");this.addComponent(n)}}class it{constructor(t){this.raw=t,this._parse()}_expand(t){const[e,n]=t.replace(/([0-9]*)(.*)/,"$1 $2").split(" "),s=[];for(let t=0;t<parseInt(e);t++)s.push(n);return s}_parse(){const t=this.raw.split(",");let e=[];for(let n of t)e=e.concat(this._expand(n));this._parsed=e}get length(){return this._parsed.length}tile(t){return this._parsed[t]}}const ot=()=>new q(((t,e)=>s(void 0,void 0,void 0,(function*(){return new Promise(((n,s)=>{const{gl:i}=t,o=new I(t,(t=>{const e=t.player,n=t.shaman;return{idle:{frames:[n.idle_1,n.idle_1,n.idle_2,n.idle_2,n.idle_1],changeTime:250},idleLeft:{frames:[n.idle_1_left,n.idle_2_left],changeTime:500},run:{frames:[n.run_1,n.idle_1],changeTime:150},runLeft:{frames:[n.run_1_left,n.idle_1_left],changeTime:150},duck:{frames:[n.roll_1,n.roll_2,n.roll_3,n.roll_4],changeTime:50},duckLeft:{frames:[n.roll_1_left,n.roll_2_left,n.roll_3_left,n.roll_4_left],changeTime:50},dmg:{frames:[e.dmg_1,e.stand_1],changeTime:50},dmgLeft:{frames:[e.dmg_1_left,e.stand_1_left],changeTime:50},fire:{frames:[n.fire],changeTime:200},fireLeft:{frames:[n.fire_left],changeTime:200}}})(t.images),[400,-10],t.session.lives,(()=>{n({gs:t,scene:e})}));e.addEntity(o),e.addEntity(new st(t)),((t,e)=>{const n=new it(["30.","3_","15.,1b","10.","3_","10.,2|","20.,1a","10.,2|","5.,3_,5.,5_","5.,3|","20.,2bb,5.","10.,1*,1-,1|,10.,1a","10.1*,1|,10.,1a","3.,2|,3.","10.,3_,5.,1a,1.,5_","3.,3|,3.","5.,3_,2.,3_,5.,1a,1.,5_","20.,3bbb,5.","10.,3|,20.,1aaa"].join(","));let s=0,i=Math.floor(t.stage.canvas.height/2);for(let o=0;o<n.length;o++){const r=n.tile(o);if("|"===r&&(e.addEntity(new et(t,[32*o,i],s.toString())),s++,i-=32),"-"===r&&(i-=32,e.addEntity(new et(t,[32*o,i],s.toString())),s++,i-=32,e.addEntity(new et(t,[32*o,i],s.toString())),s++,i+=64),"*"===r&&(i-=32,e.addEntity(new et(t,[32*o,i],s.toString())),s++,i+=32),"b"===r||"bb"===r||"bbb"===r){const n={};n.speed="b"===r?10:"bb"===r?50:100,e.addEntity(new D(t,E(t.images),[32*o,i-64],n))}if("a"===r||"aa"===r||"aaa"===r){const n={};n.boltCost="a"===r?800:"aa"===r?550:300,e.addEntity(new P(t,x(t.images),[32*o,i-64],n))}"_"!==r&&(e.addEntity(new et(t,[32*o,i],s.toString())),s++)}})(t,e),i.onUpdate((n=>{if(t.getEntities().filter((t=>"function"==typeof t.update)).forEach((e=>e.update(n,t))),"running"!==t.status)return;const[s,i]=o.getComponent("position").p,r=t.stage.canvas.width/2-s,a=t.stage.canvas.height/2-i,h=e.getEntities().filter((e=>C(e,[r,a],t.stage.canvas)));h.filter((t=>"function"==typeof t.update)).forEach((e=>e.update(n,t))),(t=>{const e=t.filter((t=>!!t.getComponent("collider").onCollide));for(let n=0;n<e.length;n++){const s=e[n],i=s.getComponent("collider");i.isColliding=!1,i.collisions=[];let{box:o,onCollide:r,boxPos:[a,h]}=s.getComponent("collider");s.getComponent("position").collisionSensors=[null,null,null,null];let l=null,d=null,c=null,u=null;for(let e=0;e<t.length;e++){const n=t[e];if(n.ID!==s.ID){const t=n.eType,{box:e,boxPos:[s,i]}=n.getComponent("collider"),p=10;for(let d=0;d<p;d++)if(j([a,h+o[1]+d],[o[0],1],[s,i],e)&&(0===d&&r(n,"bottom"),d<((null==l?void 0:l.d)||1/0))){null===l&&(l={d:0,t:""}),l.d=d,l.t=t;break}for(let l=0;l<p;l++)if(j([a,h-l-1],[o[0],1],[s,i],e)&&(0===l&&r(n,"top"),-l<((null==d?void 0:d.d)||0))){null===d&&(d={d:0,t:""}),d.d=l,d.t=t;break}for(let l=0;l<p;l++)if(j([a+o[0]+l,h],[1,o[1]],[s,i],e)){if(0===l&&r(n,"right"),l<((null==u?void 0:u.d)||1/0)){null===u&&(u={d:0,t:""}),u.d=l,u.t=t;break}break}for(let l=0;l<p;l++)if(j([a-l-1,h],[o[0],o[1]],[s,i],e)&&(0===l&&r(n,"left"),l<((null==c?void 0:c.d)||1/0))){null===c&&(c={d:0,t:""}),c.d=l,c.t=t;break}}}s.getComponent("position").collisionSensors=[d,u,l,c]}})(h.filter((t=>!!t.components.collider)))})),i.onRender((n=>{const[s,i]=o.getComponent("position").p,r=t.stage.canvas.width/2-s,a=t.stage.canvas.height/2-i;let h=e.getEntities().filter((e=>!!e.components.render&&C(e,[r,a],t.stage.canvas)));h.sort(((t,e)=>e.getComponent("render").renderPriority-t.getComponent("render").renderPriority)),h.forEach((t=>t.render(n,[r,a])))}))}))}))));class rt extends i{constructor(t){const{stage:e}=t;super(e,[]);const n=new c("#main-menu");this.addComponent(n)}init(){const t=[];t.push({class:"menu-item",text:"Story Mode",id:"new-game"}),t.push({class:"menu-item",text:"Quick Game",id:"quick-game"}),this.getComponent("menu").el.querySelector("ul").innerHTML=t.map((t=>`<li><button class="${t.class}" id="${t.id}">${t.text}</button></li>`)).join(""),super.init()}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}class at{constructor(t,e){this.max=t,this.current=e}recharge(t){this.current=Math.min(this.current+t,this.max)}use(t){this.current=Math.max(this.current-t,0)}useAll(){this.current=0}get isFull(){return this.current>=this.max}get isEmpty(){return this.current<this.max}}n(823);class ht extends i{constructor(t){const{stage:e}=t;super(e,[]),this.gs=t;const n=new c("#main-menu");this.addComponent(n)}init(){const t=[];t.push({class:"menu-item",text:"continue",id:"continue"});const e=this.getComponent("menu");e.el.querySelector("ul").innerHTML=t.map((t=>`<li><button class="${t.class}" id="${t.id}">${t.text}</button></li>`)).join(""),document.addEventListener("keydown",(t=>{"Escape"===t.key&&(e.show(),this.gs.status="paused",this.gs.stage.canvas.classList.add("paused"))})),e.addListener("#continue",(()=>{this.gs.stage.canvas.classList.remove("paused"),e.hide(),this.gs.status="running"})),super.init(),e.hide()}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}class lt extends i{constructor(t,e){const{stage:n}=t;super(n,[]),this.gs=t,this.onSkip=e;const s=new c("#ingame-msg");this.addComponent(s)}setContent(t){this.getComponent("menu").el.innerHTML=t}init(){const t=this.getComponent("menu");t.addListener("#skip",(()=>{this.gs.stage.canvas.classList.remove("paused"),t.hide(),this.gs.status="running",this.onSkip()})),super.init(),t.show(),this.gs.status="paused",this.gs.stage.canvas.classList.add("paused")}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}class dt extends i{constructor(t,e){const{stage:n}=t;super(n,[]),this.gs=t,this.onSkip=e;const s=new c("#ingame-msg");this.addComponent(s)}setContent(t){this.getComponent("menu").el.innerHTML=t}init(){const t=this.getComponent("menu");t.addListener("#skip",(()=>{location.reload()})),super.init(),t.show(),this.gs.status="paused",this.gs.stage.canvas.classList.add("paused")}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}class ct extends i{constructor(t){const{stage:e}=t;super(e,[]),this.gs=t;const n=new u("#stage");this.addComponent(n)}update(t,e){var n;const[s,i]=(null===(n=null==e?void 0:e.session)||void 0===n?void 0:n.pos)||[0,0];e.stage.canvas.style.backgroundImage="linear-gradient(0deg, #141729, #313866 30%, #505ba5)"}}const ut=t=>s(void 0,void 0,void 0,(function*(){return new Promise((e=>{const n=new lt(t,(()=>{e(null)})),s=`<div>\n<p>\nYou moved ${y(t.session.pos[0])} steps.\n<br>The spirits may help you once more.\n</p>\n<p>\n\n<button id="skip">continue</button>\n</div>`;n.setContent(s),t.addEntity(n)}))}));s(void 0,void 0,void 0,(function*(){const t=new G;t.session.lives=3,t.addEntity(new ct(t)),t.scene=new q(((t,e)=>s(void 0,void 0,void 0,(function*(){return new Promise(((n,s)=>{const{stage:i,gl:o}=t,r=new tt(i);e.addEntity(r),setTimeout((()=>{t.images=r.loadedImages,r.destroy(),n({gs:t,scene:e})}),1e3),o.start()}))})))),yield t.runScene(),t.scene=new q(((t,e)=>s(void 0,void 0,void 0,(function*(){return new Promise(((n,s)=>{const{stage:i,gl:o}=t,r=new rt(t);r.btnClick("#new-game",(()=>{r.destroy(),n("new-game")})),r.btnClick("#quick-game",(()=>{r.destroy(),n("quick-game")})),e.addEntity(r)}))}))));const e=yield t.runScene();t.status="running";const n=new ht(t);t.addEntity(n);let i="new-game"===e;for(;t.session.lives>0;)console.log("Running main scene"),t.scene=ot(),setTimeout((()=>s(void 0,void 0,void 0,(function*(){var e;i&&(yield(e=t,s(void 0,void 0,void 0,(function*(){return new Promise((t=>{const n=new lt(e,(()=>{t(null)}));n.setContent('<div>\n<p>\nIn the 13th Century, Genghis Khan created the largest contiguous empire in history.\n</p>\n<p>\nYear 1215 CE,<br>\nthe Great Khan lies mortally would by an enemy arrow. <br> Only you, his shaman, can save him, rescuing his soul from the land of the spirits.\n</p>\n<p>\n<strong>Controls</strong>\n<ul>\n<li>Jump: ↑</li>\n<li>move: ← →</li>\n<li>roll: ↓</li>\n<li>fire: Space</li>\n</ul>\n\n\n</p>\n<button id="skip">skip</button>\n</div>'),e.addEntity(n)}))}))),i=!1)}))),300),yield t.runScene(),ut(t),t.session.lives--;var o;o=t,s(void 0,void 0,void 0,(function*(){return new Promise((t=>{const e=new dt(o,(()=>{t(null),o.removeEntity(e)}));e.setContent('<div>\n<p>\nYou failed to save the Great Khan.\n</p>\n<p>\n\n<button id="skip">Play Again</button>\n</div>'),o.addEntity(e)}))}))}))}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,n),o.exports}n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};n(607)})();